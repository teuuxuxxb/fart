<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Пердун Года 2025</title>
  <style>
    body {
      background-color: #00ffcc;
      font-family: "Comic Sans MS", cursive, sans-serif;
      color: #ff0000;
      text-align: center;
    }
    marquee {
      font-size: 48px;
      font-weight: bold;
    }
    .section {
      border: 5px dashed #ff00ff;
      margin: 20px;
      padding: 15px;
      background-color: #ffff99;
    }
    img {
      width: 100px;
    }
    .counter {
      font-size: 24px;
      margin: 10px;
      color: #000;
    }
    .fart-button, .register-button, .music-button {
      padding: 10px 20px;
      font-size: 20px;
      background-color: #ff69b4;
      border: 3px solid #000;
      cursor: pointer;
      margin: 5px;
    }
    input, select, textarea {
      font-size: 18px;
      padding: 5px;
      margin: 5px;
    }
    .vote-table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    .vote-table th, .vote-table td {
      border: 2px solid #000;
      padding: 5px 10px;
    }
    .top3 {
      background-color: #ffeeba;
      padding: 10px;
      margin-bottom: 15px;
    }
    .comment-box {
      background-color: #fff;
      padding: 10px;
      margin-top: 5px;
      border: 2px dashed #000;
    }
    .piano-key {
      width: 60px;
      height: 120px;
      background-color: #fff;
      border: 3px solid #000;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 2px 4px #666;
      transition: all 0.1s ease-in-out;
    }
    .piano-key:active {
      background-color: #ffcccc;
      transform: translateY(2px);
      box-shadow: 1px 2px #444;
    }
    .fart-bubble {
      position: absolute;
      background: #ffcccc;
      border-radius: 50%;
      padding: 10px;
      animation: bubble 1s ease-out forwards;
      font-weight: bold;
      color: #000;
      pointer-events: none;
    }
    @keyframes bubble {
      0% { opacity: 1; transform: scale(1) translateY(0); }
      100% { opacity: 0; transform: scale(2) translateY(-150px); }
    }
    .comment-like {
      background: #d4edda;
      border: 1px solid #28a745;
      margin: 2px;
      padding: 3px 6px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <marquee scrollamount="10">Добро пожаловать на конкурс "ПЕРДУН ГОДА 2025"!</marquee>
  <img src="https://media.tenor.com/UoUoOtrRxkMAAAAC/fart.gif" alt="fart gif"/>

  <div class="section">
    <h2>Случайная шутка дня</h2>
    <p id="jokeDisplay"></p>
  </div>

  <div class="section">
    <h2>Регистрация</h2>
    <input type="text" id="nameInput" placeholder="Имя пердуна">
    <input type="text" id="linkInput" placeholder="Ссылка на пердеж (YouTube, VK...)">
    <button class="register-button" onclick="register()">Зарегистрироваться</button>
  </div>

  <div class="section">
    <h2>Голосуй за любимого пердуна!</h2>
    <select id="voteSelect"></select>
    <button class="fart-button" onclick="vote()">Проголосовать</button>
    <p class="counter">Всего голосов: <span id="totalVotes">0</span></p>
  </div>

  <div class="section top3">
    <h2>Топ-3 Пердуна</h2>
    <ul id="top3List"></ul>
  </div>

  <div class="section">
    <h2>Наши Участники</h2>
    <table class="vote-table">
      <thead><tr><th>Имя</th><th>Слушать</th><th>Голоса</th><th>Комментарии</th></tr></thead>
      <tbody id="participantsTable"></tbody>
    </table>
  </div>

  <div class="section">
    <h2>Фарт-пианинка</h2>
    <div id="fartPiano" style="display: flex; justify-content: center; gap: 10px; position: relative;">
      <button class="piano-key" onclick="playFart(0)">До</button>
      <button class="piano-key" onclick="playFart(1)">Ре</button>
      <button class="piano-key" onclick="playFart(2)">Ми</button>
      <button class="piano-key" onclick="playFart(3)">Фа</button>
      <button class="piano-key" onclick="playFart(4)">Соль</button>
      <button class="piano-key" onclick="playFart(5)">Ля</button>
      <button class="piano-key" onclick="playFart(6)">Си</button>
    </div>
  </div>

  <button class="music-button" onclick="toggleMusic()">Вкл/Выкл музыку</button>
  <audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
  </audio>

  <img src="https://media.tenor.com/V06eZMFzy9wAAAAC/fart-joke.gif" alt="funny fart gif">
  <footer><p>© 2025 Пердуны всего мира, объединяйтесь!</p></footer>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    push,
    onValue,
    update,
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

  
    const firebaseConfig = {
      apiKey: "AIzaSyBicpiEJcEz62qguIvIkZ4F_ednV4IqEkA",
      authDomain: "fart-of-year-b5279.firebaseapp.com",
      projectId: "fart-of-year-b5279",
      storageBucket: "fart-of-year-b5279.appspot.com",
      messagingSenderId: "643785935219",
      appId: "1:643785935219:web:dac9130e1c1a64b6f19d06",
      measurementId: "G-7C4YLC24K1"
    };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const usersRef = ref(db, "users");

  let totalVotes = 0;

  const jokes = [
    "Почему пердун не в армии? Он уже взрывался!",
    "Как называется музыкальный стиль пердунов? Пукано!",
    "Самая громкая нота – пердушная бемоль.",
    "Впердел и ушёл – вот он, настоящий артист!",
    "Ударил гром... А это Вася пукнул!",
  ];

  function getRandomJoke() {
    const joke = jokes[Math.floor(Math.random() * jokes.length)];
    document.getElementById("jokeDisplay").innerText = joke;
  }

  setInterval(getRandomJoke, 5000);
  getRandomJoke();

  function register() {
    const name = document.getElementById("nameInput").value;
    const link = document.getElementById("linkInput").value;
    if (!name || !link) return alert("Заполни все поля!");
    push(usersRef, {
      name,
      link,
      votes: 0,
      comments: [],
    });
  }

  function vote() {
    const select = document.getElementById("voteSelect");
    const userId = select.value;
    const voteRef = ref(db, "users/" + userId);
    update(voteRef, {
      votes: (users[userId].votes || 0) + 1,
    });
  }

  function addComment(userId) {
    const comment = prompt("Напиши свой отзыв:");
    if (!comment) return;
    const userRef = ref(db, "users/" + userId);
    const updatedComments = [...(users[userId].comments || []), { text: comment, likes: 0 }];
    update(userRef, { comments: updatedComments });
  }

  function likeComment(userId, commentIndex) {
    const userRef = ref(db, "users/" + userId);
    const updated = [...(users[userId].comments || [])];
    updated[commentIndex].likes += 1;
    update(userRef, { comments: updated });
  }

  let users = {};

  onValue(usersRef, (snapshot) => {
    const data = snapshot.val() || {};
    users = data;
    const select = document.getElementById("voteSelect");
    const table = document.getElementById("participantsTable");
    const top3 = document.getElementById("top3List");
    select.innerHTML = "";
    table.innerHTML = "";

    const userList = Object.entries(data);
    const sorted = userList.sort((a, b) => (b[1].votes || 0) - (a[1].votes || 0));
    totalVotes = sorted.reduce((sum, [_, val]) => sum + (val.votes || 0), 0);
    document.getElementById("totalVotes").innerText = totalVotes;

    top3.innerHTML = "";
    sorted.slice(0, 3).forEach(([_, user], i) => {
      const li = document.createElement("li");
      li.textContent = `${i + 1}. ${user.name} — ${user.votes} голосов`;
      top3.appendChild(li);
    });

    for (const [id, user] of Object.entries(data)) {
      const option = document.createElement("option");
      option.value = id;
      option.textContent = user.name;
      select.appendChild(option);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${user.name}</td>
        <td><a href="${user.link}" target="_blank">Слушать</a></td>
        <td>${user.votes || 0}</td>
        <td>
          <button onclick="addComment('${id}')">Коммент</button>
          ${(user.comments || [])
            .map((c, i) => `<div class="comment-box">
              ${c.text}
              <div class="comment-like" onclick="likeComment('${id}', ${i})">Лайков: ${c.likes}</div>
            </div>`)
            .join("")}
        </td>
      `;
      table.appendChild(tr);
    }
  });

  const fartSounds = [
    "https://www.fesliyanstudios.com/play-mp3/387",
    "https://www.fesliyanstudios.com/play-mp3/389",
    "https://www.fesliyanstudios.com/play-mp3/388",
    "https://www.fesliyanstudios.com/play-mp3/390",
    "https://www.fesliyanstudios.com/play-mp3/391",
    "https://www.fesliyanstudios.com/play-mp3/392",
    "https://www.fesliyanstudios.com/play-mp3/393",
  ];

  function playFart(index) {
    const audio = new Audio(fartSounds[index]);
    audio.play();
    const bubble = document.createElement("div");
    bubble.className = "fart-bubble";
    bubble.innerText = "ПУК!";
    const piano = document.getElementById("fartPiano");
    piano.appendChild(bubble);
    setTimeout(() => bubble.remove(), 1000);
  }

  function toggleMusic() {
    const music = document.getElementById("bgMusic");
    if (music.paused) {
      music.play();
    } else {
      music.pause();
    }
  }

  window.vote = vote;
  window.register = register;
  window.addComment = addComment;
  window.likeComment = likeComment;
  window.playFart = playFart;
  window.toggleMusic = toggleMusic;
</script>
</body>
</html>

  
